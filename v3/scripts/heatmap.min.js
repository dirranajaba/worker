(function(b){var a=(function(){function c(f){var e={data:[],heatmap:f};this.max=1;this.get=function(g){return e[g]},this.set=function(g,h){e[g]=h}}c.prototype={addDataPoint:function(e,k){if(e<0||k<0){return}var h=this,j=h.get("heatmap"),i=h.get("data");if(!i[e]){i[e]=[]}if(!i[e][k]){i[e][k]=0}i[e][k]+=(arguments.length<3)?1:arguments[2];h.set("data",i);if(h.max<i[e][k]){h.max=i[e][k];j.get("actx").clearRect(0,0,j.get("width"),j.get("height"));for(var g in i){for(var f in i[g]){j.drawAlpha(g,f,i[g][f])}}return}j.drawAlpha(e,k,i[e][k])},setDataSet:function(j){var f=this,i=f.get("heatmap"),g=[],k=j.data,h=k.length;i.clear();this.max=j.max;while(h--){var e=k[h];i.drawAlpha(e.x,e.y,e.count);if(!g[e.x]){g[e.x]=[]}if(!g[e.x][e.y]){g[e.x][e.y]=0}g[e.x][e.y]=e.count}this.set("data",g)},exportDataSet:function(){var h=this,i=h.get("data"),f=[];for(var g in i){if(g===undefined){continue}for(var e in i[g]){if(e===undefined){continue}f.push({x:parseInt(g,10),y:parseInt(e,10),count:i[g][e]})}}return{max:h.max,data:f}},generateRandomDataSet:function(i){var l=this.get("heatmap"),f=l.get("width"),g=l.get("height");var k={},e=Math.floor(Math.random()*1000+1);k.max=e;var j=[];while(i--){j.push({x:Math.floor(Math.random()*f+1),y:Math.floor(Math.random()*g+1),count:Math.floor(Math.random()*e+1)})}k.data=j;this.setDataSet(k)}};function d(f){var e={radiusIn:20,radiusOut:40,element:{},canvas:{},acanvas:{},ctx:{},actx:{},visible:true,width:0,height:0,max:false,gradient:false,opacity:180,debug:false};this.store=new c(this);this.get=function(g){return e[g]},this.set=function(g,h){e[g]=h};this.configure(f);this.init()}d.prototype={configure:function(f){var h=this;if(f.radius){var e=f.radius,g=parseInt(e/2,10)}h.set("radiusIn",g||15),h.set("radiusOut",e||40),h.set("element",(f.element instanceof Object)?f.element:document.getElementById(f.element));h.set("visible",f.visible);h.set("max",f.max||false);h.set("gradient",f.gradient||{0.45:"rgb(0,0,255)",0.55:"rgb(0,255,255)",0.65:"rgb(0,255,0)",0.95:"yellow",1:"rgb(255,0,0)"});h.set("opacity",parseInt(255/(100/f.opacity),10)||180);h.set("width",f.width||0);h.set("height",f.height||0);h.set("debug",f.debug)},init:function(){var h=this,f=document.createElement("canvas"),e=document.createElement("canvas"),g=h.get("element");h.initColorPalette();h.set("canvas",f);h.set("acanvas",e);f.width=e.width=g.style.width.replace(/px/,"")||h.getWidth(g);h.set("width",f.width);f.height=e.height=g.style.height.replace(/px/,"")||h.getHeight(g);h.set("height",f.height);f.style.position=e.style.position="absolute";f.style.top=e.style.top="0";f.style.left=e.style.left="0";f.style.zIndex=1000000;if(!h.get("visible")){f.style.display="none"}h.get("element").appendChild(f);if(h.get("debug")){document.body.appendChild(e)}h.set("ctx",f.getContext("2d"));h.set("actx",e.getContext("2d"))},initColorPalette:function(){var h=this,g=document.createElement("canvas");g.width="1";g.height="256";var f=g.getContext("2d"),j=f.createLinearGradient(0,0,1,256),i=h.get("gradient");for(var e in i){j.addColorStop(e,i[e])}f.fillStyle=j;f.fillRect(0,0,1,256);h.set("gradient",f.getImageData(0,0,1,256).data);delete g;delete j;delete f},getWidth:function(e){var f=e.offsetWidth;if(e.style.paddingLeft){f+=e.style.paddingLeft}if(e.style.paddingRight){f+=e.style.paddingRight}return f},getHeight:function(f){var e=f.offsetHeight;if(f.style.paddingTop){e+=f.style.paddingTop}if(f.style.paddingBottom){e+=f.style.paddingBottom}return e},colorize:function(t,s){var r=this,g=r.get("width"),p=r.get("radiusOut"),u=r.get("height"),q=r.get("actx"),v=r.get("ctx");var f=p*2;if(t+f>g){t=g-f}if(t<0){t=0}if(s<0){s=0}if(s+f>u){s=u-f}var k=q.getImageData(t,s,f,f),e=k.data,h=e.length,j=r.get("gradient"),o=r.get("opacity");for(var n=3;n<h;n+=4){var l=e[n],m=l*4;if(!m){continue}e[n-3]=j[m];e[n-2]=j[m+1];e[n-1]=j[m+2];e[n]=(l<o)?l:o}k.data=e;v.putImageData(k,t,s)},drawAlpha:function(m,k,h){var j=this,f=j.get("radiusIn"),e=j.get("radiusOut"),n=j.get("actx"),l=j.get("max"),p=n.createRadialGradient(m,k,f,m,k,e),o=m-e,i=k-e,g=2*e;p.addColorStop(0,"rgba(0,0,0,"+((h)?(h/j.store.max):"0.1")+")");p.addColorStop(1,"rgba(0,0,0,0)");n.fillStyle=p;n.fillRect(o,i,g,g);j.colorize(o,i)},toggleDisplay:function(){var f=this,g=f.get("visible"),e=f.get("canvas");if(!g){e.style.display="block"}else{e.style.display="none"}f.set("visible",!g)},getImageData:function(){return this.get("canvas").toDataURL()},clear:function(){var g=this,e=g.get("width"),f=g.get("height");g.store.set("data",[]);g.get("ctx").clearRect(0,0,e,f);g.get("actx").clearRect(0,0,e,f)},cleanup:function(){var e=this;e.get("element").removeChild(e.get("canvas"));delete e}};return{create:function(e){return new d(e)},util:{mousePosition:function(f){var e,g;if(f.layerX){e=f.layerX;g=f.layerY}else{if(f.offsetX){e=f.offsetX;g=f.offsetY}}if(typeof(e)=="undefined"){return}return[e,g]}}}})();b.h337=b.heatmapFactory=a})(window);