var map,infoBox,openinfo,maphome,servicearea,heatmap,geometryLoaded=!1,reviews=[],fixedinfobox=!1,serviceareapolys=[],heatmapitems=[],firstLoad=!0,IE7=-1!=navigator.appVersion.indexOf("MSIE 7."),IE8=-1!=navigator.appVersion.indexOf("MSIE 8.");function defer(e){window.jQuery?e(jQuery):setTimeout(function(){defer(e)},50)}defer(function(e){function a(){var a=null;a="undefined"!=typeof mapStyle&&null!==mapStyle?mapStyle:[{featureType:"all",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"administrative.neighborhood",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.park",stylers:[{hue:"#9bc2bd"},{saturation:-80}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"road.highway",elementType:"labels",stylers:[{saturation:-60},{lightness:0}]},{featureType:"road.highway",elementType:"geometry",stylers:[{saturation:-50}]},{featureType:"road.arterial",elementType:"labels",stylers:[{saturation:-50},{lightness:70}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{saturation:-70}]}];var o=zl,n=!1,l={zoom:zl,maxZoom:14,minZoom:8,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!1,scrollwheel:scrollw,draggable:!0,navigationControl:!0,mapTypeControl:!1,scaleControl:!0,disableDoubleClickZoom:!1,fullscreenControl:!1};if(showmap){(map=new google.maps.Map(document.getElementById("nn-review-map-main"),l)).setOptions({styles:a}),IE7||IE8||(heatmap=new HeatmapOverlay(map,{radius:15,visible:!0,opacity:60}));var s=new google.maps.LatLng(lat,lng);map.setCenter(s)}document.getElementById("nn-review-map-main")&&(google.maps.event.addListener(map,"center_changed",function(e){n=!0}),google.maps.event.addListener(map,"idle",function(a){var l=map.getZoom(),s=!1;o&&l!=o&&(o=l,s=!0),(s||firstLoad||n)&&(!function(){reviews&&e.each(reviews,function(e,a){a.setMap(null)});reviews=[];var a=map.getBounds().getNorthEast(),t=map.getBounds().getSouthWest();e.getJSON("https://api.sidebox.com/plugin/storefrontreviewsp?jsoncallback=?",{storefrontToken:sf,nElat:a.lat(),nElng:a.lng(),sWlat:t.lat(),sWlng:t.lng()},function(a){e.each(a,function(e,a){var t=a.OverallRating,o=null!=t&&t>0&&t<=5?"https://d2gwjd5chbpgug.cloudfront.net/v2/images/review-map-icon-"+t+"-star.png":"v2/images/review-map-icon-5.png",n=new google.maps.Marker({position:new google.maps.LatLng(a.Lat,a.Long),map:map,title:(a.Summary?'"'+a.Summary+'"\r\n':"")+a.ResponseDateRel,icon:o,rid:a.rid});reviews.push(n)})})}(),function(){var a=map.getBounds().getNorthEast(),o=map.getBounds().getSouthWest();if(e.getJSON("https://api.sidebox.com/plugin/storefrontheatmapp?jsoncallback=?",{storefrontToken:sf,nElat:a.lat(),nElng:a.lng(),sWlat:o.lat(),sWlng:o.lng()},function(a){if(heatmapitems&&(IE7||IE8)&&e.each(heatmapitems,function(e,a){a.setMap(null)}),heatmapitems=[],e.each(a,function(e,a){if(IE7||IE8){var t=new google.maps.LatLng(a.Lat,a.Long),o="#0000ff",n=250,l=map.getZoom(),s=a.CheckinCount/3;switch(l){case 8:n=8e3;break;case 9:n=4e3;break;case 10:n=2e3;break;case 11:n=1e3;break;case 12:n=500;break;case 13:n=250;break;case 14:n=125}var i={strokeColor:o=s>=22?"#CC0000":s>=19?"#D22000":s>=16?"#D94000":s>=13?"#DF6000":s>=10?"#E68000":s>=7?"#EC9F00":s>=4?"#F2BF00":"#F9DF00",strokeOpacity:.25,strokeWeight:1,fillColor:o,fillOpacity:.25,map:map,center:t,radius:n},r=new google.maps.Circle(i);heatmapitems.push(r)}else heatmapitems.push({lat:a.Lat,lng:a.Long,count:a.CheckinCount})}),!IE7&&!IE8){var t=1;a.length>=1&&(t=a[0].MaxCheckinCount);var o={max:t,data:heatmapitems};heatmap.setDataSet(o)}}),geometryLoaded){e.each(serviceareapolys,function(e,a){a.setMap(null)}),serviceareapolys=[];var n=map.getZoom();e.getJSON("https://api.sidebox.com/plugin/storefrontserviceareaencodedP?jsoncallback=?",{storefrontToken:sf,nElat:a.lat(),nElng:a.lng(),sWlat:o.lat(),sWlng:o.lng(),ZoomLevel:n},function(a){var o,n=null,l=[];e.each(a,function(e,a){a.PolyNo!=n&&(l.length>0&&((o=t(n,l)).setMap(map),serviceareapolys.push(o)),l=[]),n=a.PolyNo,l.push(a.EncodedRing)}),l.length>0&&((o=t(n,l)).setMap(map),serviceareapolys.push(o))})}else{var l=[],n=map.getZoom();e.getJSON("https://api.sidebox.com/plugin/storefrontserviceareap?jsoncallback=?",{storefrontToken:sf,nElat:a.lat(),nElng:a.lng(),sWlat:o.lat(),sWlng:o.lng(),ZoomLevel:n},function(a){servicearea&&servicearea.setMap(null),e.each(a,function(e,a){l.push(new google.maps.LatLng(a.Lat,a.Long))}),(servicearea=new google.maps.Polygon({paths:l,strokeColor:"#64A8D1",strokeOpacity:.75,strokeWeight:2,fillColor:"#64A8D1",fillOpacity:.45})).setMap(map)})}}(),firstLoad=!1,n=!1)}))}function t(a,t){var o=[];return e.each(t,function(e,a){var t=google.maps.geometry.encoding.decodePath(a);o.push(t)}),new google.maps.Polygon({clickable:!1,paths:o,strokeColor:"#64A8D1",strokeOpacity:.75,strokeWeight:2,fillColor:"#64A8D1",fillOpacity:.45})}e(document).ready(function(){"object"==typeof google&&"object"==typeof google.maps?NN.initialize():gmak?e.getScript("https://maps.google.com/maps/api/js?key="+gmak+"&libraries=geometry&callback=NN.initialize",function(){}):e.getScript("https://maps.google.com/maps/api/js?libraries=geometry&callback=NN.initialize",function(){})}),window.NN=window.NN||{},NN.initialize=function(){geometryLoaded="object"==typeof google.maps.geometry,"object"==typeof HeatmapOverlay?a():e.getScript("v3/scripts/heatmap-gmaps.js",function(){a()})}});